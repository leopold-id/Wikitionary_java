package projetFinal;

import java.io.FileInputStream;
import java.io.FileOutputStream;
import java.io.IOException;
import java.io.ObjectInputStream;
import java.io.ObjectOutputStream;

import javax.xml.parsers.ParserConfigurationException;
import javax.xml.stream.XMLStreamException;
import javax.xml.transform.TransformerException;
import java.util.regex.Pattern;
import java.util.HashMap;
import java.util.regex.Matcher;

import wiktionary_extractor.Page;
import wiktionary_extractor.PageExtractor;

public class WikiTest {

	public static void main(String[] args) throws IOException, XMLStreamException, ParserConfigurationException,
			TransformerException, ClassNotFoundException {
		String filename = "simplified_frwiktionary.xml.bz2";

		HashMap<String, Lamentin> dictionnaire = new HashMap<>();

		int count = 0;
		for (Page p : new PageExtractor(filename)) {
			// Pour sauvergarder la page dans un fichier la page peut
			// ensuite être rechargée en passant le nom du fichier à
			// PageExtractor.
			p.toXML("test.xml");
			// Pour accéder au contenu (wikitext) et au titre d'une page

			// Il y a **beaucoup** de pages. Sans condition d'arrêt le
			// programme risque de mettre beaucoup de temps à
			// s'exécuter

			

			// ne récupère que le français
			String[] content = p.content.split("\\{\\{langue");
			
			// exite les fausses pages
			if (content.length > 1) {
				String filtrage = content[1];
				
				// crée l'objet lamentin à partir de la page wiki
				Lamentin mot = new Lamentin(filtrage);

				// l'ajoute au dictionnaire
				dictionnaire.put(p.title, mot);
				
				// affichage
				// System.out.println(p.title);
				// System.out.println(p.content);

				count += 1;
				System.out.println(count);

			}

			/*count += 1;
			if (count == 24) {
				System.out.println(p.title);
				System.out.println(p.content);
				break;
			}*/
		}
		// @@@@@@@@@@@@@@@@ bloc qui sérialise @@@@@@@@@@@@@@@@@@@@@@@@

		FileOutputStream fos = new FileOutputStream("extract.ser");
		ObjectOutputStream oos = new ObjectOutputStream(fos);

		oos.writeObject(dictionnaire);

		oos.close();

		System.out.println(count);

		// @@@@@@@@@@@@@@@@ bloc qui désérialise @@@@@@@@@@@@@@@@@@@@@@@@

		// System.out.println(dico1);
	}

}
