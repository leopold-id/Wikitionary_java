package projet_final;

import java.util.ArrayList;
import java.util.HashMap;

import org.apache.commons.cli.*;

public class test_parse {
	
	public static Options initOptions() {

	    Option mot = Option.builder("h") 
	            .longOpt("help") //
	            .desc("help") 
	            .hasArg(false) 
	            .required(false) 
	            .build();

	    Option mot = Option.builder("m") 
	            .longOpt("mot") //
	            .desc("mot") 
	            .hasArg(true) 
	            .required(true) 
	            .build();

	    Option information = Option.builder("i") 
	            .longOpt("information") 
	            .desc("information") 
	            .hasArg(true) 
	            .required(true) 
	            .build();


	    Options arguments = new Options();

	    arguments.addOption(mot);
	    arguments.addOption(information);

	    return arguments;
	}
	
	
	public static void main (String[] args) throws ParseException {
		
		// Initialisation du parser et des requetes possibles 
		Options options = initOptions();
		
		CommandLineParser parser = new DefaultParser();
		CommandLine cmd = parser.parse(options, args);
		
		if (cmd.hasOption("h") {
			System.out.println("Ce programme permet d'obtenir des informations lexicales extraites de Wikitionnary.");
			System.out.println("Arguments:");
			System.out.println("-m mot");
			System.out.println("-i information, à choisir au sein de la liste suivante: \\"pro\\" \\(prononciation\\), \\"pos\\" \\(cat. morpho-syntaxique\\), \\"trad\\" \\(traductions\\), \\"syn\\" \\(synonymes\\), \\"ant\\" \\(antonymes\\) )
		} else {
	
			// Parsing des arguments donnés en ligne de commande 
			String mot_demande = cmd.getOptionValue("m");
			String requete = cmd.getOptionValue("i");

			// deserialisation
			FileInputStream fis = new FileInputStream("extract.ser");
			ObjectInputStream ois = new ObjectInputStream(fis);

			HashMap<String, Lamentin> extract = (HashMap<String, Lamentin>) ois.readObject();

			// Vérification que le mot est dans le dictionnaire 
			if (!extract.containsKey(mot_demande)) {
				System.out.println("Le mot demandé n'est pas dans le dictionnaire");
			} else {
				if (requete.equals("all")) {
					System.out.println(extract.get(mot_demande).introspection());
				} else {
					System.out.println(extract.get(mot_demande).select(requete));
				}
			}
			ois.close();
		}	
	}	
}
